For tumors with highly complex shapes, a 'patching' strategy is often used in passively scattered proton therapy to match the sharp distal edge of the spread-out Bragg peak (SOBP) of the patch field to the lateral penumbra of the through field at 50% dose level. The differences in the dose gradients at the distal edge and at the lateral penumbra could cause hot and cold doses at the junction. In this note, we describe an algorithm developed to optimize the range compensator design to yield a more uniform dose distribution at the junction. The algorithm is based on the fact that the distal fall-off of the SOBP can be tailored using a grid filter that is placed perpendicular to the beam's path. The filter is optimized so that the distal fall-off of the patch field complements the lateral penumbra fall-off of the through field. In addition to optimizing the fall-off, the optimization process implicitly accounts for the limitations of conventional compensator design algorithms. This algorithm uses simple ray tracing to determine the compensator shape and ignore scatter. The compensated dose distribution may therefore differ substantially from the intended dose distribution, especially when complex heterogeneities are encountered, such as those in the head and neck. In such a case, an adaptive optimization strategy can be used to optimize the 'grid' filter locally considering the tissue heterogeneities. The grid filter thus obtained is superimposed on the original range compensator so that the composite compensator leads to a more uniform dose distribution at the patch junction. An L-shaped head and neck tumor was used to demonstrate the validity of the proposed algorithm. A robustness analysis with focus on range uncertainty effect is carried out