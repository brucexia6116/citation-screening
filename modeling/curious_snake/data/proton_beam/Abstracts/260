In three-dimensional irradiation with pencil beam scanning, an extra dose is inevitably delivered to the irradiated site due to the finite reaction times of the beam delivery system, and it causes a severe distortion of the dose distribution in the target region. Since the amount of the extra dose is proportional to the beam intensity, the dose uniformity deteriorates as the beam intensity is increased in order to shorten the treatment time. In order to overcome this problem and shorten the treatment time, we have developed an optimization method in which the extra dose is integrated into the optimization process of the best weighting matrix. The effectiveness and applicability of the optimization method for spot and raster scanning irradiation were confirmed with computer simulations and also confirmed using irradiation experiments for spot scanning irradiation. The treatment time could be shortened to about one sixth of the time needed without taking the extra dose into account while obtaining the same degree of dose homogeneity in the target volume. A typical treatment time with the proposed method is about 15 s for the irradiation of a spherical target with an 80 mm diameter at 3 GyE