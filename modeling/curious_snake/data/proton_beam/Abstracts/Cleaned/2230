method photon dose calculation radio therapy planning using pencil beam energy deposition kernels presented designed meet requirements algorithm treatment planning general handle irregularly shaped radiation fields incident heterogeneous patient point oriented faster convolution algorithm uses physical data base characterize clinical beam convolution algorithm shown photon therapy beams characterized great accuracy combination precalculated monte carlo energy deposition kernels dose distributions measured water phantom data used derive analytical pencil beam kernels approximately partitionated dose primary released electrons positrons ii scattered bremsstrahlung annihilation photons iii contaminating photons iv charged particles collimator head semianalytical integration method based triangulation field developed dose calculation using analytical kernels dose calculated units normalized incident energy fluence facilitates output factor calculation application heterogeneous media scatter correction factor derived using monodirectional convolution ray path homogeneous media results compared measurements heterogeneous media monte carlo calculations batho method NUMBER d NUMBER d NUMBER d