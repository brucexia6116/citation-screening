Three-dimensional dose planning systems employing accurate proton transport algorithms are essential for calculating absorbed dose distributions in proton therapy. In this paper, a pencil beam algorithm for the transport of protons in materials of interest for radiation therapy is developed. The Fermi-Eyges multiple-scattering theory is used to derive transport equations for calculating proton fluence and absorbed dose distributions. The multiple-scattering theory of Moliere is used to predict mean square scattering angles and to develop an expression for calculating the root mean square (RMS) radial spread of a proton pencil beam, as a function of depth, in an arbitrary scattering material. A correction factor is suggested to account for the decrease in the radial spread at the end of the range due to range straggling. The effects of neglecting large-angle scattering events and the possibility of incorporating such events into the pencil beam algorithm are discussed. An energy scaling technique for determining the water-equivalent surface energy at a given depth in a heterogeneous scattering medium is developed. The water-equivalent energy, giving the same Moliere scattering parameter B in water, is determined and the 1/e angle in water is scaled to the appropriate width in the scattering material. By using stored analytically or Monte Carlo calculated pencil beam distributions in water, the large-angle single-scattering events may be incorporated by approximating the scattering in an arbitrary material by the scattering in water for protons of the appropriate water-equivalent surface energy