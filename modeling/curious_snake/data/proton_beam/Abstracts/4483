We have proposed a new dose optimization method for proton and heavy ion therapy using generalized sampled pattern matching, where an optimal beam weight distribution for scanning is obtained as a solution. Using water phantom models, one-dimensional lateral and depth dose distributions were separately optimized, each resulting in a uniform dose distribution within a target region and minimum dose fall-off to minimize undesired irradiation onto neighbouring tissues. Subsequently, we have applied the technique to broad beam three-dimensional proton therapy, leading to a homogeneous dose distribution inside a target and minimized distal and lateral dose fall-off for most convex tumour shapes