We describe a novel code system, TRiP, dedicated to the planning of radiotherapy with energetic ions, in particular 12C. The software is designed to cooperate with three-dimensional active dose shaping devices like the GSI raster scan system. This unique beam delivery system allows us to select any combination from a list of 253 individual beam energies, 7 different beam spot sizes and 15 intensity levels. The software includes a beam model adapted to and verified for carbon ions. Inverse planning techniques are implemented in order to obtain a uniform target dose distribution from clinical input data, i.e. CT images and patient contours. This implies the automatic generation of intensity modulated fields of heavy ions with as many as 40000 raster points, where each point corresponds to a specific beam position, energy and particle fluence. This set of data is directly passed to the beam delivery and control system. The treatment planning code has been in clinical use since the start of the GSI pilot project in December 1997. Forty-eight patients have been successfully planned and treated