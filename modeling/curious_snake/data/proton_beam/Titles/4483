Dose optimization of proton and heavy ion therapy using generalized sampled pattern matching