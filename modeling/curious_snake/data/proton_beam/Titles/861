3D online compensation of target motion with scanned particle beam